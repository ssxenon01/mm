jQuery(function(){var f=jQuery(document),a=function(b,a){var c=jQuery(a).closest(".widget"),h=c.find(".csb-pro-layer"),g=c.find(".widget-control-actions .widget-control-save"),n=c.find(".widget-control-actions .spinner");!0!=c.data("_csb_free")&&(n.insertBefore(g).css({"float":"left"}),h.insertBefore(g),c.data("_csb_free",!0))};jQuery("#widgets-right").find(".widget").each(a);f.on("widget-added",a)});
function CsSidebar(f,a){this.id=f.split("%").join("\\%");this.type=a;this.sb=jQuery("#"+this.id);this.widgets="";this.name=trim(this.sb.find(".sidebar-name h3").text());this.description=trim(this.sb.find(".sidebar-description").text());var b="custom"==a?csSidebars.extras.find(".cs-custom-sidebar").clone():csSidebars.extras.find(".cs-theme-sidebar").clone();this.sb.parent().append(b);b.find("label").each(function(){var b=jQuery(this);csSidebars.addIdToLabel(b,f)})}CsSidebar.prototype.getID=function(){return this.id.split("\\").join("")};
var csSidebars,msgTimer;
(function(f){csSidebars={sidebars:[],sidebar_prefix:"cs-",edit_form:null,delete_form:null,export_form:null,location_form:null,right:null,extras:null,action_handlers:{},init:function(){"undefined"!=typeof csSidebarsData&&csSidebars.initControls().initScrollbar().initTopTools().initSidebars().initToolbars().initColumns()},initControls:function(){csSidebars.right=jQuery("#widgets-right");csSidebars.extras=jQuery("#cs-widgets-extra");null==csSidebars.edit_form&&(csSidebars.edit_form=csSidebars.extras.find(".cs-editor").clone(),
csSidebars.extras.find(".cs-editor").remove());null==csSidebars.delete_form&&(csSidebars.delete_form=csSidebars.extras.find(".cs-delete").clone(),csSidebars.extras.find(".cs-delete").remove());null==csSidebars.export_form&&(csSidebars.export_form=csSidebars.extras.find(".cs-export").clone(),csSidebars.extras.find(".cs-export").remove());null==csSidebars.location_form&&(csSidebars.location_form=csSidebars.extras.find(".cs-location").clone(),csSidebars.extras.find(".cs-location").remove());jQuery("#cs-title-options").detach().prependTo(csSidebars.right);
return csSidebars},initScrollbar:function(){var a=jQuery(".widget-liquid-right");wnd=jQuery(window);scrollbar=viewport=null;csSidebars.right.addClass("overview").wrap('<div class="viewport" />');viewport=jQuery(".viewport").height(wnd.height()-60);a.height(wnd.height()).prepend('<div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>').tinyscrollbar();scrollbar=a.data("plugin_tinyscrollbar");var b=function(){scrollbar.update("relative")};wnd.resize(function(){a.height(wnd.height());
viewport.height(wnd.height()-60);scrollbar.update("relative")});a.click(function(){setTimeout(b,400)});a.hover(function(){f(".scrollbar").fadeIn()},function(){f(".scrollbar").fadeOut()});return csSidebars},initColumns:function(){var a=csSidebars.right.find(".sidebars-column-1"),b=csSidebars.right.find(".sidebars-column-2"),d=jQuery('<div class="cs-title"><h3></h3></div>'),c=csSidebars.right.find(".widgets-holder-wrap");b.length||(b=jQuery('<div class="sidebars-column-2"></div>'),b.appendTo(csSidebars.right));
d.clone().prependTo(a).find("h3").text(csSidebarsData.custom_sidebars);d.clone().prependTo(b).find("h3").text(csSidebarsData.theme_sidebars);a=jQuery('<div class="inner"></div>').appendTo(a);b=jQuery('<div class="inner"></div>').appendTo(b);c.each(function(){var d=jQuery(this),c=d.find(".widgets-sortables");csSidebars.isCustomSidebar(c)?d.appendTo(a):d.appendTo(b)})},initSidebars:function(){csSidebars.right.find(".widgets-sortables").each(function(){var a,b;a=jQuery(this);var d=a.attr("id");if(!0!==
a.data("cs-init"))if(a.data("cs-init",!0),csSidebars.isCustomSidebar(this))csSidebars.add(d,"custom");else{a=csSidebars.add(d,"theme");b=!1;for(key in csSidebarsData.replaceable)if(csSidebarsData.replaceable[key]==d){b=!0;break}csSidebars.setReplaceable(a,b,!1)}});return csSidebars},initTopTools:function(){var a=jQuery(".btn-create-sidebar"),b=jQuery(".btn-export"),d={};a.click(function(){d.id="";d.title=csSidebarsData.title_new;d.button=csSidebarsData.btn_new;d.description="";d.name="";csSidebars.showEditor(d)});
b.click(csSidebars.showExport);return csSidebars},initToolbars:function(){csSidebars.registerAction("edit",csSidebars.showEditor);csSidebars.registerAction("location",csSidebars.showLocations);csSidebars.registerAction("delete",csSidebars.showRemove);csSidebars.registerAction("replaceable",csSidebars.setReplaceable);csSidebars.right.on("click",".cs-tool",function(a){var b=jQuery(a.target).closest(".cs-tool");a=b.data("action");b=csSidebars.getIdFromEditbar(b);b=csSidebars.find(b);return!csSidebars.handleAction(a,
b)});return csSidebars},handleAction:function(a,b){return"function"==typeof csSidebars.action_handlers[a]?!!csSidebars.action_handlers[a](b):!1},registerAction:function(a,b){csSidebars.action_handlers[a]=b},showAjaxError:function(a){var b={};b.message=csSidebarsData.ajax_error;b.details=a;b.parent="#widgets-right";b.insert_after="#cs-title-options";b.id="editor";b.type="err";wpmUi.message(b)},showEditor:function(a){var b=null,d=null;a instanceof CsSidebar&&(a={id:a.getID(),title:csSidebarsData.title_edit.replace("[Sidebar]",
a.name),button:csSidebarsData.btn_edit});var c=function(){b.$().removeClass("csb-has-more");b.size(null,215)},h=function(a,d,c){b.loading(!1);if(!a)return!1;if(!d)return b.close(),csSidebars.showAjaxError(a),!1;void 0!==a.sidebar&&(a=a.sidebar);void 0!==a.id&&b.$().find("#csb-id").val(a.id);void 0!==a.name&&b.$().find("#csb-name").val(a.name);void 0!==a.description&&b.$().find("#csb-description").val(a.description);void 0!==a.before_title&&b.$().find("#csb-before-title").val(a.before_title);void 0!==
a.after_title&&b.$().find("#csb-after-title").val(a.after_title);void 0!==a.before_widget&&b.$().find("#csb-before-widget").val(a.before_widget);void 0!==a.after_widget&&b.$().find("#csb-after-widget").val(a.after_widget);void 0!==a.button&&b.$().find(".btn-save").text(a.button)},g=function(a,d,c){c={};b.loading(!1).close();c.message=a.message;c.parent="#widgets-right";c.insert_after="#cs-title-options";c.id="editor";d?"update"==a.action?(d=csSidebars.find(a.data.id),csSidebars.updateSidebar(d,a.data)):
"insert"==a.action&&csSidebars.insertSidebar(a.data):c.type="err";wpmUi.message(c)},b=wpmUi.popup().modal(!0).title(a.title).onshow(c).content(csSidebars.edit_form);c();h(a,!0,null);d=wpmUi.ajax(null,"cs-ajax");a.id&&(b.loading(!0),d.reset().data({"do":"get",sb:a.id}).ondone(h).load_json());b.show();b.$().find("#csb-name").focus();b.$().on("click","#csb-more",function(){jQuery(this).prop("checked")?(b.$().addClass("csb-has-more"),b.size(null,545)):c()});b.$().on("click",".btn-save",function(){var a=
b.$().find("form");b.loading(!0);d.reset().data(a).ondone(g).load_json();return!1});b.$().on("click",".btn-cancel",b.close);return!0},updateSidebar:function(a,b){a.sb.find(".sidebar-name h3").text(b.name);a.sb.find(".sidebar-description").html('<p class="description"></p>').find(".description").text(b.description);return csSidebars},insertSidebar:function(a){var b=jQuery('<div class="widgets-holder-wrap"></div>'),d=jQuery('<div class="widgets-sortables ui-sortable"></div>'),c=jQuery('<div class="sidebar-name"><div class="sidebar-name-arrow"><br></div><h3></h3></div>'),
h=jQuery('<div class="sidebar-description"></div>'),g=csSidebars.right.find(".sidebars-column-1 > .inner:first");d.attr("id",a.id);c.find("h3").text(a.name);h.html('<p class="description"></p>').find(".description").text(a.description);c.appendTo(d);h.appendTo(d);d.appendTo(b);b.prependTo(g);jQuery("#widgets-right .sidebar-name").unbind("click");jQuery("#widgets-left .sidebar-name").unbind("click");jQuery(document.body).unbind("click.widgets-toggle");jQuery(".widgets-chooser").off("click.widgets-chooser").off("keyup.widgets-chooser");
wpWidgets.init();csSidebars.initSidebars();return csSidebars},showExport:function(){wpmUi.popup().modal(!0).size(740,480).title(csSidebarsData.title_export).content(csSidebars.export_form).show();return!0},showRemove:function(a){var b=null,d=null,c=a.getID(),h=a.name,g=function(a,d,g){g={};b.loading(!1).close();g.message=a.message;g.parent="#widgets-right";g.insert_after="#cs-title-options";g.id="editor";d?(csSidebars.right.find("#"+c).closest(".widgets-holder-wrap").remove(),csSidebars.remove(c)):
g.type="err";wpmUi.message(g)},b=wpmUi.popup().modal(!0).size(null,160).title(csSidebarsData.title_delete).content(csSidebars.delete_form).onshow(function(a){a.find(".name").text(h)}).show(),d=wpmUi.ajax(null,"cs-ajax");b.$().on("click",".btn-cancel",function(){b.loading(!1).close()});b.$().on("click",".btn-delete",function(){b.loading(!0);d.reset().data({"do":"delete",sb:c}).ondone(g).load_json()});return!0},showLocations:function(a){var b=null,d=null,c=null;a=a.getID();var h=function(a,d,c){c={};
b.loading(!1).close();c.message=a.message;c.parent="#widgets-right";c.insert_after="#cs-title-options";c.id="editor";d||(c.type="err");wpmUi.message(c)},b=wpmUi.popup().modal(!0).size(null,560).title(csSidebarsData.title_location).content(csSidebars.location_form).show();b.loading(!0);c=b.$().find(".frm-location");c.find(".sb-id").val(a);d=wpmUi.ajax(null,"cs-ajax");d.reset().data({"do":"get-location",sb:a}).ondone(function(a,d,c){b.loading(!1);if(d){b.$().find(".sb-name").text(a.sidebar.name);var h=
a.sidebar.id;d=b.$().find(".cs-replaceable");d.hide();for(e in a.replaceable)d.filter("."+a.replaceable[e]).show();var f=function(a,b){var c=jQuery("<option></option>");c.attr("value",e).text(a.name);b.append(c)};d=function(a,b,c,d){b=d.closest(".cs-replaceable").filter("."+b);c=b.find('option[value="'+c+'"]');d=b.find("optgroup.used");var e=b.find(".detail-toggle");a==h?(c.prop("selected",!0),!0!=e.prop("checked")&&(e.prop("checked",!0),b.addClass("open"),wpmUi.upgrade_multiselect(b))):(d.length||
(d=jQuery('<optgroup class="used">').attr("label",b.data("lbl-used")).appendTo(b.find(".details select"))),c.detach().appendTo(d))};var m=b.$().find(".cs-datalist.cs-cat"),k=b.$().find(".cs-datalist.cs-arc-cat");c=a.categories;k.empty();m.empty();for(var e in c)f(c[e],k),f(c[e],m);for(e in c){if(c[e].single)for(var l in c[e].single)d(c[e].single[l],l,e,m);if(c[e].archive)for(l in c[e].archive)d(c[e].archive[l],l,e,k)}k=b.$().find(".cs-datalist.cs-pt");c=a.posttypes;k.empty();for(e in c)f=jQuery("<option></option>"),
m=c[e].name,f.attr("value",e).text(m),k.append(f);for(e in c)if(c[e].single)for(l in c[e].single)d(c[e].single[l],l,e,k);k=b.$().find(".cs-datalist.cs-arc");c=a.archives;k.empty();for(e in c)f=jQuery("<option></option>"),m=c[e].name,f.attr("value",e).text(m),k.append(f);for(e in c)if(c[e].archive)for(l in c[e].archive)d(c[e].archive[l],l,e,k)}else b.close(),csSidebars.showAjaxError(a)}).load_json();b.$().on("click",".detail-toggle",function(a){a=jQuery(this);var b=a.closest(".cs-replaceable"),c=b.find("select");
a.prop("checked")?(b.addClass("open"),wpmUi.upgrade_multiselect(b),c.trigger("change.select2")):b.removeClass("open")});b.$().on("click",".btn-save",function(){b.loading(!0);d.reset().data(c).ondone(h).load_json()});b.$().on("click",".btn-cancel",b.close);return!0},setReplaceable:function(a,b,d){var c=jQuery(a.sb).closest(".widgets-holder-wrap"),f=c.find(".cs-toolbar .chk-replaceable"),g=c.find(".replace-marker");c.find(".cs-toolbar .btn-replaceable");void 0==b&&(b=f.prop("checked"));void 0==d&&(d=
!0);if(f.data("active")==b)return!1;f.data("active",b);f.prop("checked",b);b?(g.length||jQuery("<div></div>").appendTo(c).attr("data-label",csSidebarsData.lbl_replaceable).addClass("replace-marker"),c.addClass("replaceable")):(g.remove(),c.removeClass("replaceable"));d&&(d=wpmUi.ajax(null,"cs-ajax"),d.reset().data({"do":"replaceable",state:b,sb:a.getID()}).load_json());return!1},find:function(a){return csSidebars.sidebars[a]},add:function(a,b){csSidebars.sidebars[a]=new CsSidebar(a,b);return csSidebars.sidebars[a]},
remove:function(a){delete csSidebars.sidebars[a]},isCustomSidebar:function(a){return jQuery(a).attr("id").substr(0,csSidebars.sidebar_prefix.length)==csSidebars.sidebar_prefix},addIdToLabel:function(a,b){if(!0!=a.data("label-done")){var d=a.attr("for");a.attr("for",d+b);a.find(".has-label").attr("id",d+b);a.data("label-done",!0)}},getIdFromEditbar:function(a){return a.closest(".widgets-holder-wrap").find(".widgets-sortables:first").attr("id")}};jQuery(function(a){a("#csfooter").hide();0<a("#widgets-right").length&&
csSidebars.init();a(".defaultsContainer").hide();a("#widgets-right .widgets-sortables").on("sort",function(b,d){a("#widgets-right");d.position.top=-a("#widgets-right").css("top")})})})(jQuery);function trim(f){f=f.replace(/^\s\s*/,"");for(var a=f.length-1;0<=a;a--)if(/\S/.test(f.charAt(a))){f=f.substring(0,a+1);break}return f};
